{{- if or (eq .env "stage") (eq .env "prod") (eq .env "euprod") }}
---
image: {{ .project }}-web-prod
from: node:20-alpine
git:
- add: /
  to: /workspace/calendar
  stageDependencies:
    setup:
    - "*/**"
    install:
    - "package.json"
    - "package-lock.json"
    - "yarn.lock"
    - ".yarnrc.yml"
    - "playwright.config.ts"
    - "turbo.json"
    - "git-init.sh"
    - "git-setup.sh"
ansible:
  install:
  - name: "install packages"
    shell: yarn workspace @calcom/web add
    args:
     chdir: /workspace/calendar
  - name: "prune web"
    shell: npx turbo prune --scope=@calcom/web
    args:
     chdir: /workspace/calendar
  setup:
  - name: "build web"
    shell: npm run build
    args:
     chdir: /workspace/calendar
docker:
  WORKDIR: /workspace/calendar
  EXPOSE: ["3000"]
  ENTRYPOINT: "npm run start"
{{- end }}
